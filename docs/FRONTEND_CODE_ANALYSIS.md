# Анализ проблем фронтенда

## Критичные проблемы

### 1. Жестко закодированный URL API в конфигурации

**Файл:** `frontend/src/shared/api/config.ts`
**Проблема:** Base URL API жестко закодирован как `http://localhost:3000/api`, что делает невозможным использование разных окружений (dev, staging, production) без изменения кода.
**Риски:**

- Невозможность деплоя на разные окружения
- Нарушение принципа 12-factor app
- Потенциальные проблемы с CORS в production
  **Решение:** Использовать переменные окружения Vite (`import.meta.env.VITE_API_URL`)

### 2. Отсутствие валидации пользовательского ввода

**Файлы:**

- `frontend/src/pages/login/index.tsx`
- `frontend/src/pages/register/index.tsx`
- `frontend/src/widgets/lesson/ui/question_input.tsx`
  **Проблема:** Нет валидации длины, формата и санитизации пользовательского ввода перед отправкой на сервер.
  **Риски:**
- Возможность отправки слишком длинных строк
- Отсутствие защиты от инъекций через пользовательский ввод
- Плохой UX при некорректных данных
  **Решение:** Добавить клиентскую валидацию с использованием библиотеки типа `zod` или `yup`

### 3. Логирование конфиденциальных данных в консоль

**Файл:** `frontend/src/shared/model/auth/auth-model.ts`
**Проблема:** В production коде присутствуют `console.log` с данными авторизации (логин, пароль, ответы сервера).
**Риски:**

- Утечка конфиденциальных данных в консоль браузера
- Возможность перехвата данных через DevTools
- Нарушение GDPR и других требований безопасности
  **Решение:** Удалить все `console.log` из production кода или использовать условное логирование только в development режиме

### 4. Отсутствие обработки истечения сессии

**Файлы:**

- `frontend/src/shared/api/base/client.ts`
- `frontend/src/shared/ui/auth-guard/auth-guard.tsx`
  **Проблема:** При получении 401 ошибки от API не происходит автоматический logout и очистка состояния авторизации.
  **Риски:**
- Пользователь может остаться в авторизованном состоянии после истечения сессии
- Потенциальные проблемы с безопасностью
  **Решение:** Добавить глобальный обработчик ошибок 401, который вызывает logout и перенаправляет на страницу логина

### 5. Проблема с бесконечным циклом в InitializedProvider

**Файл:** `frontend/src/app/providers/with-initialized.tsx`
**Проблема:** `useEffect` с зависимостью от `appInitialized` вызывает `checkAuthFx()`, что может привести к бесконечным запросам при ошибках.
**Риски:**

- Бесконечные запросы к API
- Перегрузка сервера
- Плохой UX
  **Решение:** Исправить зависимости `useEffect` или использовать другой подход для инициализации

## Важные проблемы

### 6. Отсутствие типизации с использованием `any`

**Файлы:**

- `frontend/src/shared/api/hooks/use-api.ts` (строки 12, 16, 17, 29, 62, 70)
- `frontend/src/features/course-card/ui/CourseCard.tsx` (строка 292)
  **Проблема:** Использование типа `any` снижает безопасность типов TypeScript и может привести к ошибкам во время выполнения.
  **Риски:**
- Потеря преимуществ статической типизации
- Возможные runtime ошибки
- Сложность поддержки кода
  **Решение:** Заменить все `any` на конкретные типы или дженерики

### 7. Отсутствие глобальной обработки ошибок API

**Файл:** `frontend/src/shared/api/base/client.ts`
**Проблема:** Ошибки API обрабатываются локально в каждом компоненте, отсутствует централизованная система уведомлений об ошибках.
**Риски:**

- Неконсистентное отображение ошибок
- Дублирование кода обработки ошибок
- Плохой UX при ошибках
  **Решение:** Реализовать глобальный обработчик ошибок с уведомлениями (например, через snackbar/toast)

### 8. Отсутствие защиты от XSS в Markdown рендерере

**Файл:** `frontend/src/shared/ui/markdown-renderer/markdown-renderer.tsx`
**Проблема:** Хотя `react-markdown` в целом безопасен, ссылки открываются в `target="_blank"` без дополнительной защиты от `window.opener` атак.
**Риски:**

- Потенциальные XSS атаки через вредоносные ссылки
- Уязвимость к tabnabbing атакам
  **Решение:** Убедиться что все внешние ссылки имеют `rel="noopener noreferrer"` (уже есть, но стоит проверить конфигурацию)

### 9. Отсутствие rate limiting на клиенте

**Файлы:**

- `frontend/src/widgets/lesson/model/use_lesson_page.ts`
- `frontend/src/widgets/test/ui/TextQuestion.tsx`
  **Проблема:** Нет защиты от множественных быстрых запросов от пользователя.
  **Риски:**
- Возможность перегрузки сервера множественными запросами
- Плохой UX при случайных двойных кликах
  **Решение:** Добавить debounce/throttle для критичных действий и визуальную блокировку кнопок во время загрузки

### 10. Отсутствие обработки сетевых ошибок

**Файл:** `frontend/src/shared/api/base/client.ts`
**Проблема:** Недостаточная обработка случаев когда сеть недоступна или запрос прерван.
**Риски:**

- Непонятные ошибки для пользователя при проблемах с сетью
- Отсутствие retry механизма для transient ошибок
  **Решение:** Добавить обработку `NetworkError`, `AbortError` и retry логику для определенных типов ошибок

### 11. Отсутствие валидации ответов API

**Файлы:** Все API методы в `frontend/src/shared/api/`
**Проблема:** Ответы от API не валидируются на соответствие ожидаемым типам перед использованием.
**Риски:**

- Runtime ошибки при изменении структуры ответа API
- Потенциальные проблемы безопасности при обработке неожиданных данных
  **Решение:** Использовать библиотеку валидации (zod, yup) для runtime валидации ответов API

### 12. Проблемы с производительностью в компонентах

**Файлы:**

- `frontend/src/widgets/lesson/model/use_lesson_page.ts`
- `frontend/src/widgets/lesson/ui/LessonPage.tsx`
  **Проблема:** Отсутствие мемоизации для дорогих вычислений и компонентов, возможные лишние ререндеры.
  **Риски:**
- Медленная работа приложения
- Излишнее потребление ресурсов
  **Решение:** Использовать `useMemo`, `useCallback`, `React.memo` где необходимо

## Средние проблемы

### 13. Дублирование логики обработки ошибок

**Файлы:** Множество компонентов содержат похожую логику обработки ошибок
**Проблема:** Одинаковая логика обработки ошибок повторяется в разных компонентах.
**Риски:**

- Дублирование кода
- Сложность поддержки
  **Решение:** Вынести общую логику в переиспользуемые хуки или утилиты

### 14. Отсутствие обработки состояния загрузки на уровне приложения

**Проблема:** Каждый компонент управляет своим состоянием загрузки независимо.
**Риски:**

- Дублирование кода
- Неконсистентное поведение
  **Решение:** Создать общий контекст или store для управления глобальными состояниями загрузки

### 15. Отсутствие проверки типов во время выполнения для параметров маршрута

**Файлы:** Все страницы использующие `useParams`
**Проблема:** Параметры из URL не валидируются перед использованием.
**Риски:**

- Runtime ошибки при некорректных параметрах
- Потенциальные проблемы безопасности
  **Решение:** Добавить валидацию параметров маршрута или использовать типизированные роутеры

### 16. Отсутствие метрик и мониторинга ошибок

**Проблема:** Нет системы сбора ошибок и метрик производительности.
**Риски:**

- Сложность диагностики проблем в production
- Отсутствие данных для оптимизации
  **Решение:** Интегрировать Sentry, LogRocket или аналогичные сервисы

### 17. Отсутствие тестов

**Проблема:** В проекте отсутствуют unit и integration тесты для компонентов и логики.
**Риски:**

- Высокий риск регрессий при изменениях
- Сложность рефакторинга
  **Решение:** Добавить тесты используя Jest и React Testing Library

### 18. Неоптимальная конфигурация code splitting

**Файл:** `frontend/vite.config.ts`
**Проблема:** Ручная конфигурация `manualChunks` может быть неоптимальной и требовать постоянной поддержки.
**Риски:**

- Неоптимальный размер бандлов
- Сложность поддержки
  **Решение:** Использовать автоматический code splitting или оптимизировать конфигурацию на основе анализа бандла

### 19. Отсутствие обработки случая когда API возвращает неожиданный формат данных

**Файл:** `frontend/src/shared/api/base/client.ts`
**Проблема:** При ошибке парсинга JSON возвращается общая ошибка без деталей.
**Риски:**

- Сложность диагностики проблем
- Плохой UX
  **Решение:** Улучшить обработку ошибок парсинга с более информативными сообщениями

### 20. Использование `@ts-ignore` вместо правильной типизации

**Файлы:**

- `frontend/src/shared/ui/markdown-renderer/markdown-renderer.tsx` (строки 300-301)
- `frontend/src/widgets/test/ui/TextQuestion.tsx` (строки 58-60)
  **Проблема:** Использование `@ts-ignore` скрывает проблемы типизации вместо их решения.
  **Риски:**
- Возможные runtime ошибки
- Потеря преимуществ TypeScript
  **Решение:** Исправить типизацию вместо использования `@ts-ignore`

## Неприоритетные проблемы

### 21. Отсутствие accessibility (a11y) атрибутов

**Проблема:** Компоненты не имеют достаточных ARIA атрибутов для screen readers.
**Риски:**

- Недоступность для пользователей с ограниченными возможностями
- Нарушение стандартов доступности
  **Решение:** Добавить ARIA атрибуты, семантические HTML теги, поддержку клавиатурной навигации

### 22. Отсутствие i18n (интернационализации)

**Проблема:** Все тексты захардкожены на русском языке.
**Риски:**

- Невозможность использования приложения на других языках
  **Решение:** Интегрировать библиотеку i18n (react-i18next, formatjs)

### 23. Отсутствие оптимизации изображений

**Проблема:** Если в будущем будут использоваться изображения, нет механизма их оптимизации.
**Риски:**

- Большой размер бандла
- Медленная загрузка
  **Решение:** Настроить Vite плагины для оптимизации изображений или использовать CDN

### 24. Отсутствие PWA функциональности

**Проблема:** Приложение не может работать как Progressive Web App.
**Риски:**

- Ограниченный функционал для мобильных устройств
  **Решение:** Добавить Service Worker, manifest.json, offline поддержку

### 25. Отсутствие документации по компонентам

**Проблема:** Компоненты не имеют документации API (Props, примеры использования).
**Риски:**

- Сложность использования компонентов другими разработчиками
  **Решение:** Использовать Storybook или JSDoc для документирования компонентов

### 26. Отсутствие линтинга и форматирования в pre-commit хуках

**Проблема:** Нет автоматической проверки кода перед коммитом.
**Риски:**

- Непоследовательный стиль кода
- Потенциальные ошибки в репозитории
  **Решение:** Настроить husky + lint-staged для автоматической проверки кода

### 27. Отсутствие CI/CD pipeline для фронтенда

**Проблема:** Нет автоматической проверки и деплоя при пуше кода.
**Риски:**

- Ручной процесс деплоя подвержен ошибкам
  **Решение:** Настроить GitHub Actions или аналогичный CI/CD для автоматизации

### 28. Большой размер vendor chunks

**Файл:** `frontend/vite.config.ts`
**Проблема:** Vendor chunks могут быть слишком большими из-за включения всех зависимостей MUI.
**Риски:**

- Медленная первичная загрузка
  **Решение:** Использовать tree-shaking для MUI, загружать только используемые компоненты

### 29. Отсутствие кэширования API запросов

**Проблема:** Одинаковые запросы выполняются повторно без кэширования.
**Риски:**

- Излишняя нагрузка на сервер
- Медленная работа приложения
  **Решение:** Реализовать кэширование на уровне API клиента или использовать библиотеку типа React Query

### 30. Отсутствие оптимистичных обновлений UI

**Проблема:** UI обновляется только после получения ответа от сервера.
**Риски:**

- Ощущение медленной работы приложения
  **Решение:** Реализовать оптимистичные обновления для улучшения UX

