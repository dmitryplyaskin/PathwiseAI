# Интеграция страницы урока с бэкендом

## Что было реализовано

### 1. API для работы с уроками

**Типы (`frontend/src/shared/api/lessons/types.ts`):**

```typescript
export interface Lesson {
  id: string;
  title: string;
  content: string;
  order: number;
  status: LessonStatus;
  // ... другие поля
}
```

**API методы (`frontend/src/shared/api/lessons/api.ts`):**

```typescript
lessonsApi.getLessonById(id: string): Promise<Lesson>
```

### 2. Effector модель для урока

**Store'ы:**

- `$currentLesson` - текущий урок
- `$lessonLoading` - статус загрузки
- `$lessonError` - ошибка загрузки
- `$lessonNotFound` - флаг "урок не найден"

**Events:**

- `loadLesson(lessonId: string)` - загрузить урок
- `resetLesson()` - сбросить состояние

**Хук для компонентов:**

```typescript
const { lesson, loading, notFound } = useLesson(lessonId);
```

### 3. Обновленный компонент LessonPage

**Функциональность:**

- ✅ Получает `lessonId` из URL параметров
- ✅ Автоматически загружает урок при монтировании
- ✅ Показывает прелоадер во время загрузки
- ✅ Отображает реальные данные урока (заголовок и контент)
- ✅ Если урок не найден - показывает демо-контент с уведомлением
- ✅ Сбрасывает состояние при размонтировании

## Логика работы

### Успешная загрузка урока

```
1. Пользователь переходит на /courses/:courseId/lessons/:lessonId
2. LessonPage получает lessonId из URL
3. useLesson автоматически загружает урок
4. Показывается прелоадер
5. После загрузки отображается реальный контент урока
```

### Урок не найден

```
1. API возвращает 404
2. $lessonNotFound = true
3. Отображается Alert "Урок не найден. Показываем демо-контент"
4. Используется mockLessonContent из файла model/mock.ts
```

## Примеры использования

### Создание и просмотр урока

1. **Создайте урок через модальное окно:**
   - Нажмите "Создать урок"
   - Заполните форму
   - После генерации произойдет автоматический редирект на страницу урока

2. **Просмотр существующего урока:**
   - Перейдите по URL `/courses/{courseId}/lessons/{lessonId}`
   - Урок автоматически загрузится и отобразится

### Тестирование с несуществующим уроком

```
Откройте: /courses/any-id/lessons/non-existent-id
Результат: Покажется демо-контент с уведомлением
```

## Структура файлов

```
frontend/src/
├── shared/
│   ├── api/
│   │   └── lessons/
│   │       ├── api.ts          # API методы
│   │       ├── types.ts        # TypeScript типы
│   │       └── index.ts        # Экспорты
│   └── model/
│       └── lessons/
│           ├── lessons-model.ts # Effector store'ы и effects
│           ├── use-lesson.ts    # React хук
│           └── index.ts         # Экспорты
└── widgets/
    └── lesson/
        └── ui/
            └── LessonPage.tsx   # Обновленный компонент
```

## Технические детали

### Загрузка данных

**Бэкенд эндпоинт:**

```
GET /courses/lessons/:id
```

**Ответ:**

```json
{
  "id": "uuid",
  "title": "Название урока",
  "content": "Markdown контент",
  "order": 1,
  "status": "not_started",
  "created_at": "2025-09-29T...",
  "updated_at": "2025-09-29T..."
}
```

### Управление состоянием

```typescript
// Автоматическая загрузка при монтировании
useEffect(() => {
  if (lessonId) {
    loadLesson(lessonId);
  }
  return () => {
    resetLesson(); // Очистка при размонтировании
  };
}, [lessonId]);
```

### Fallback на демо-контент

```typescript
const lessonContent = lesson?.content || mockLessonContent;
const lessonTitle = lesson?.title || 'Введение в машинное обучение';
```

## Состояния компонента

### 1. Загрузка (loading: true)

```
┌─────────────────────────────┐
│                             │
│    🔄  Загрузка урока...    │
│                             │
└─────────────────────────────┘
```

### 2. Урок загружен (lesson: Lesson)

```
┌─────────────────────────────┐
│  Реальное название урока    │
│                             │
│  [Markdown контент урока]   │
│                             │
│  [ИИ-помощник]             │
└─────────────────────────────┘
```

### 3. Урок не найден (notFound: true)

```
┌─────────────────────────────┐
│  Введение в МО (демо)       │
│  ℹ️ Урок не найден.         │
│     Показываем демо-контент │
│                             │
│  [Демо markdown контент]    │
└─────────────────────────────┘
```

## Будущие улучшения

- [ ] Добавить навигацию между уроками
- [ ] Показывать прогресс изучения урока
- [ ] Интегрировать реальный чат с AI вместо симуляции
- [ ] Добавить возможность редактирования урока
- [ ] Реализовать систему закладок и заметок
- [ ] Добавить тесты и вопросы к уроку
