# Генерация уроков через AI

## Что было реализовано

### Бэкенд

1. **Интеграция OpenRouterService в CoursesModule**
   - `OpenRouterService` теперь доступен в `CoursesService`
   - Добавлен метод `generateLessonContent()` для генерации контента урока через AI

2. **Обновлен метод `createModule`**
   - Автоматически создает или использует существующий Unit для курса
   - Генерирует полноценный контент урока через OpenRouter API
   - Сохраняет урок в базу данных
   - Возвращает структуру с `courseId`, `lessonId`, `unitId`, `title` и `content`

3. **AI промпт для генерации урока**
   - Система учитывает уровень сложности (simple, normal, professional)
   - Генерирует структурированный контент в Markdown формате
   - Включает введение, основной материал, примеры и резюме

### Фронтенд

1. **Обновлена модальное окно создания урока**
   - Добавлен прелоадер с красивым UI во время генерации
   - Показывается сообщение "Создаем урок... AI генерирует персонализированный контент"
   - После успешного создания происходит автоматический редирект на страницу урока

2. **Обновлены типы**
   - `CreateModuleResponse` теперь содержит `courseId`, `lessonId`, `unitId`

3. **Навигация**
   - После создания урока пользователь перенаправляется на `/courses/:courseId/lessons/:lessonId`

## Настройка

### 1. Убедитесь, что у вас есть API ключ OpenRouter

В файле `.env` должен быть указан ключ:

\`\`\`env
OPENROUTER_API_KEY=sk-or-v1-...
OPENROUTER_MODEL=anthropic/claude-3.5-sonnet
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_APP_NAME=PathwiseAI
OPENROUTER_SITE_URL=http://localhost:3000
\`\`\`

### 2. Запустите seed для создания тестового пользователя

\`\`\`bash
npm run seed
\`\`\`

### 3. Запустите бэкенд

\`\`\`bash
npm run start:dev
\`\`\`

### 4. Запустите фронтенд

\`\`\`bash
cd frontend
npm run dev
\`\`\`

## Использование

1. Откройте приложение в браузере
2. Нажмите кнопку "Создать урок"
3. Заполните форму:
   - Введите тему урока
   - Опционально добавьте детали
   - Выберите курс (или создайте новый)
   - Выберите уровень сложности
4. Нажмите "Создать"
5. Появится прелоадер с анимацией
6. После генерации вы автоматически перейдете на страницу созданного урока

## Технические детали

### Структура данных

**Запрос (CreateModuleRequest):**
\`\`\`typescript
{
topic: string;
details?: string;
complexity: 'simple' | 'normal' | 'professional';
courseId?: string;
newCourseName?: string;
userId: string;
}
\`\`\`

**Ответ (CreateModuleResponse):**
\`\`\`typescript
{
courseId: string;
lessonId: string;
unitId: string;
title: string;
content: string; // Markdown контент урока
}
\`\`\`

### Генерация контента

AI получает промпт с:

- Темой урока
- Дополнительными деталями (если указаны)
- Уровнем сложности

И генерирует структурированный урок в Markdown формате с:

- Введением
- Основным материалом с примерами
- Практическими советами
- Кратким резюме

### Время генерации

В зависимости от сложности темы и загрузки OpenRouter API, генерация обычно занимает **5-15 секунд**.

## Возможные проблемы

### API ключ не работает

Проверьте, что:

- Ключ правильно указан в `.env`
- У вас есть кредиты на OpenRouter
- Бэкенд был перезапущен после изменения `.env`

### Ошибка "User with username admin not found"

Запустите seed:
\`\`\`bash
npm run seed
\`\`\`

### Редирект не работает

Убедитесь, что маршрут `/courses/:id/lessons/:lessonId` существует в роутере (он уже добавлен).

## Будущие улучшения

- [ ] Добавить возможность регенерации урока
- [ ] Сохранять промежуточные версии
- [ ] Добавить предпросмотр контента перед сохранением
- [ ] Поддержка потокового вывода для более быстрого отображения
- [ ] Генерация вопросов для самопроверки
- [ ] Генерация изображений и диаграмм
