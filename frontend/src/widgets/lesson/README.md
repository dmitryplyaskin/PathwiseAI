# Виджет Lesson - Структура компонентов

## Описание

Компонент страницы урока с поддержкой ИИ-помощника, веток разговоров и интерактивного контента.

## Структура файлов

### Model (`model/`)

- **`lesson_api.ts`** - Сервис для работы с API запросами
  - `LessonApiService` - класс с статическими методами для всех операций с API
  - `Message` - интерфейс для сообщений в компоненте

- **`use_lesson_page.ts`** - Хук для управления состоянием страницы урока
  - Управление ветками и сообщениями
  - Обработчики всех действий пользователя
  - Интеграция с API через `LessonApiService`

- **`mock.ts`** - Мок-данные для демо-режима
- **`index.ts`** - Реэкспорт всех сущностей из модели

### UI Components (`ui/`)

#### Основные компоненты:

- **`LessonPage.tsx`** - Главный компонент страницы урока
  - Использует все подкомпоненты
  - Управляет общим layout'ом

#### Компоненты отображения:

- **`loading_screen.tsx`** - Экран загрузки урока
- **`lesson_header.tsx`** - Заголовок урока с градиентом
- **`lesson_content.tsx`** - Отображение материала урока (всегда сверху)

#### Компоненты взаимодействия:

- **`thread_panel.tsx`** - Панель управления ветками разговоров
- **`message_item.tsx`** - Отдельное сообщение (пользователь/ИИ/прелоадер)
- **`message_list.tsx`** - Список сообщений текущей ветки
- **`question_input.tsx`** - Поле ввода вопроса для ИИ-помощника

#### Диалоговые компоненты:

- **`thread_menu.tsx`** - Меню выбора и управления ветками
- **`message_menu.tsx`** - Меню действий с сообщением (перегенерация)
- **`delete_dialog.tsx`** - Диалог подтверждения удаления ветки

- **`StickyInfoBlock.tsx`** - Боковая панель с информацией (не изменялся)
- **`index.ts`** - Реэкспорт всех UI компонентов

## Порядок отображения

1. **Материал урока** - всегда отображается сверху
2. **Панель управления ветками** - выбор текущей ветки и создание новых
3. **Список сообщений** - сообщения выбранной ветки
4. **Поле ввода вопроса** - для взаимодействия с ИИ-помощником

## Особенности реализации

### Разделение ответственности

- **Model** - вся бизнес-логика и работа с API
- **UI** - только отображение и передача событий
- Каждый UI компонент отвечает за одну функцию

### Именование файлов

- Используется **snake_case** для всех файлов (кроме главных экспортируемых компонентов)
- Соответствует требованиям проекта

### Работа с API

- Все запросы инкапсулированы в `LessonApiService`
- Обработка ошибок на уровне сервиса
- Типизация всех ответов и параметров

### Состояние

- Централизованное управление через хук `useLessonPage`
- Разделение состояния на: данные, UI-состояния, флаги загрузки
- Мемоизация коллбеков для оптимизации

## Использование

```tsx
import { LessonPage } from '@/widgets/lesson';

// В роутере
<Route path="/lessons/:lessonId" element={<LessonPage />} />;
```

## Зависимости

- `@mui/material` - UI компоненты
- `react-router` - роутинг
- `@/shared/api/lessons` - API методы
- `@/shared/ui` - общие UI компоненты (MarkdownRenderer)
- `@/shared/model/lessons` - хук useLesson
